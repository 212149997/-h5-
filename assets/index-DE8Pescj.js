import{c as G,m as L,n as x,t as ae,i as $,e as le,j as S,w as H,k as Ee,s as Le,l as Te,o as Me,q as Pe,r as Be,f as Ae,a as Z,v as Re,x as _e,p as N,C as $e,y as p,z as Oe}from"./base-DteUoiKX.js";import{s as re,e as K,d as o,v as ze,r as W,f as I,x as De,w as Fe,y as qe,z as _,m as ie,j as Ne,F as We}from"./index-KQJvGa4P.js";import{I as T}from"./index-m4oRTMpA.js";import{u as je,F as Ge,a as He,b as Ke}from"./use-scope-id-C893SgoT.js";const Ue={to:[String,Object],url:String,replace:Boolean};function Ye({to:e,url:n,replace:i,$router:s}){e&&s?s[i?"replace":"push"](e):n&&(i?location.replace(n):location.href=n)}function Je(){const e=re().proxy;return()=>Ye(e)}let Qe=0;function Xe(){const e=re(),{name:n="unknown"}=(e==null?void 0:e.type)||{};return`${n}-${++Qe}`}const[Ze,k]=G("cell"),oe={tag:L("div"),icon:String,size:String,title:x,value:x,label:x,center:Boolean,isLink:Boolean,border:ae,iconPrefix:String,valueClass:$,labelClass:$,titleClass:$,titleStyle:null,arrowDirection:String,required:{type:[Boolean,String],default:null},clickable:{type:Boolean,default:null}},pe=le({},oe,Ue);var et=K({name:Ze,props:pe,setup(e,{slots:n}){const i=Je(),s=()=>{if(n.label||S(e.label))return o("div",{class:[k("label"),e.labelClass]},[n.label?n.label():e.label])},r=()=>{var c;if(n.title||S(e.title)){const h=(c=n.title)==null?void 0:c.call(n);return Array.isArray(h)&&h.length===0?void 0:o("div",{class:[k("title"),e.titleClass],style:e.titleStyle},[h||o("span",null,[e.title]),s()])}},d=()=>{const c=n.value||n.default;if(c||S(e.value))return o("div",{class:[k("value"),e.valueClass]},[c?c():o("span",null,[e.value])])},M=()=>{if(n.icon)return n.icon();if(e.icon)return o(T,{name:e.icon,class:k("left-icon"),classPrefix:e.iconPrefix},null)},w=()=>{if(n["right-icon"])return n["right-icon"]();if(e.isLink){const c=e.arrowDirection&&e.arrowDirection!=="right"?`arrow-${e.arrowDirection}`:"arrow";return o(T,{name:c,class:k("right-icon")},null)}};return()=>{var c;const{tag:h,size:f,center:O,border:P,isLink:z,required:D}=e,C=(c=e.clickable)!=null?c:z,V={center:O,required:!!D,clickable:C,borderless:!P};return f&&(V[f]=!!f),o(h,{class:k(V),role:C?"button":void 0,tabindex:C?0:void 0,onClick:i},{default:()=>{var E;return[M(),r(),d(),w(),(E=n.extra)==null?void 0:E.call(n)]}})}}});const tt=H(et);function ce(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function nt(e,n){if(ce(e)){if(n.required)return!1;if(n.validateEmpty===!1)return!0}return!(n.pattern&&!n.pattern.test(String(e)))}function at(e,n){return new Promise(i=>{const s=n.validator(e,n);if(Me(s)){s.then(i);return}i(s)})}function ee(e,n){const{message:i}=n;return Pe(i)?i(e,n):i||""}function lt({target:e}){e.composing=!0}function te({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function rt(e,n){const i=Ee();e.style.height="auto";let s=e.scrollHeight;if(Te(n)){const{maxHeight:r,minHeight:d}=n;r!==void 0&&(s=Math.min(s,r)),d!==void 0&&(s=Math.max(s,d))}s&&(e.style.height=`${s}px`,Le(i))}function it(e){return e==="number"?{type:"text",inputmode:"decimal"}:e==="digit"?{type:"tel",inputmode:"numeric"}:{type:e}}function y(e){return[...e].length}function j(e,n){return[...e].slice(0,n).join("")}const[ot,b]=G("field"),ct={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:x,formatter:Function,clearIcon:L("clear"),modelValue:Be(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:L("focus"),formatTrigger:L("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},st=le({},oe,ct,{rows:x,type:L("text"),rules:Array,autosize:[Boolean,Object],labelWidth:x,labelClass:$,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var ut=K({name:ot,props:st,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:n,slots:i}){const s=Xe(),r=ze({status:"unvalidated",focused:!1,validateMessage:""}),d=W(),M=W(),w=W(),{parent:c}=Ae(Ge),h=()=>{var t;return String((t=e.modelValue)!=null?t:"")},f=t=>{if(S(e[t]))return e[t];if(c&&S(c.props[t]))return c.props[t]},O=I(()=>{const t=f("readonly");if(e.clearable&&!t){const a=h()!=="",l=e.clearTrigger==="always"||e.clearTrigger==="focus"&&r.focused;return a&&l}return!1}),P=I(()=>w.value&&i.input?w.value():e.modelValue),z=I(()=>{var t;const a=f("required");return a==="auto"?(t=e.rules)==null?void 0:t.some(l=>l.required):a}),D=t=>t.reduce((a,l)=>a.then(()=>{if(r.status==="failed")return;let{value:u}=P;if(l.formatter&&(u=l.formatter(u,l)),!nt(u,l)){r.status="failed",r.validateMessage=ee(u,l);return}if(l.validator)return ce(u)&&l.validateEmpty===!1?void 0:at(u,l).then(g=>{g&&typeof g=="string"?(r.status="failed",r.validateMessage=g):g===!1&&(r.status="failed",r.validateMessage=ee(u,l))})}),Promise.resolve()),C=()=>{r.status="unvalidated",r.validateMessage=""},V=()=>n("endValidate",{status:r.status,message:r.validateMessage}),E=(t=e.rules)=>new Promise(a=>{C(),t?(n("startValidate"),D(t).then(()=>{r.status==="failed"?(a({name:e.name,message:r.validateMessage}),V()):(r.status="passed",a(),V())})):a()}),F=t=>{if(c&&e.rules){const{validateTrigger:a}=c.props,l=p(a).includes(t),u=e.rules.filter(g=>g.trigger?p(g.trigger).includes(t):l);u.length&&E(u)}},se=t=>{var a;const{maxlength:l}=e;if(S(l)&&y(t)>+l){const u=h();if(u&&y(u)===+l)return u;const g=(a=d.value)==null?void 0:a.selectionEnd;if(r.focused&&g){const m=[...t],v=m.length-+l;return m.splice(g-v,v),m.join("")}return j(t,+l)}return t},B=(t,a="onChange")=>{const l=t;t=se(t);const u=y(l)-y(t);if(e.type==="number"||e.type==="digit"){const m=e.type==="number";t=_e(t,m,m)}let g=0;if(e.formatter&&a===e.formatTrigger){const{formatter:m,maxlength:v}=e;if(t=m(t),S(v)&&y(t)>+v&&(t=j(t,+v)),d.value&&r.focused){const{selectionEnd:R}=d.value,X=j(l,R);g=y(m(X))-y(X)}}if(d.value&&d.value.value!==t)if(r.focused){let{selectionStart:m,selectionEnd:v}=d.value;if(d.value.value=t,S(m)&&S(v)){const R=y(t);u?(m-=u,v-=u):g&&(m+=g,v+=g),d.value.setSelectionRange(Math.min(m,R),Math.min(v,R))}}else d.value.value=t;t!==e.modelValue&&n("update:modelValue",t)},ue=t=>{t.target.composing||B(t.target.value)},q=()=>{var t;return(t=d.value)==null?void 0:t.blur()},U=()=>{var t;return(t=d.value)==null?void 0:t.focus()},A=()=>{const t=d.value;e.type==="textarea"&&e.autosize&&t&&rt(t,e.autosize)},de=t=>{r.focused=!0,n("focus",t),_(A),f("readonly")&&q()},fe=t=>{r.focused=!1,B(h(),"onBlur"),n("blur",t),!f("readonly")&&(F("onBlur"),_(A),Oe())},Y=t=>n("clickInput",t),ge=t=>n("clickLeftIcon",t),me=t=>n("clickRightIcon",t),he=t=>{N(t),n("update:modelValue",""),n("clear",t)},J=I(()=>{if(typeof e.error=="boolean")return e.error;if(c&&c.props.showError&&r.status==="failed")return!0}),be=I(()=>{const t=f("labelWidth"),a=f("labelAlign");if(t&&a!=="top")return{width:Z(t)}}),ve=t=>{t.keyCode===13&&(!(c&&c.props.submitOnEnter)&&e.type!=="textarea"&&N(t),e.type==="search"&&q()),n("keypress",t)},Q=()=>e.id||`${s}-input`,ye=()=>r.status,Se=()=>{const t=b("control",[f("inputAlign"),{error:J.value,custom:!!i.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(i.input)return o("div",{class:t,onClick:Y},[i.input()]);const a={id:Q(),ref:d,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:t,disabled:f("disabled"),readonly:f("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,autocapitalize:e.autocapitalize,autocorrect:e.autocorrect,enterkeyhint:e.enterkeyhint,spellcheck:e.spellcheck,"aria-labelledby":e.label?`${s}-label`:void 0,onBlur:fe,onFocus:de,onInput:ue,onClick:Y,onChange:te,onKeypress:ve,onCompositionend:te,onCompositionstart:lt};return e.type==="textarea"?o("textarea",a,null):o("input",ie(it(e.type),a),null)},Ce=()=>{const t=i["left-icon"];if(e.leftIcon||t)return o("div",{class:b("left-icon"),onClick:ge},[t?t():o(T,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])},Ie=()=>{const t=i["right-icon"];if(e.rightIcon||t)return o("div",{class:b("right-icon"),onClick:me},[t?t():o(T,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},ke=()=>{if(e.showWordLimit&&e.maxlength){const t=y(h());return o("div",{class:b("word-limit")},[o("span",{class:b("word-num")},[t]),Ne("/"),e.maxlength])}},xe=()=>{if(c&&c.props.showErrorMessage===!1)return;const t=e.errorMessage||r.validateMessage;if(t){const a=i["error-message"],l=f("errorMessageAlign");return o("div",{class:b("error-message",l)},[a?a({message:t}):t])}},we=()=>{const t=f("labelWidth"),a=f("labelAlign"),l=f("colon")?":":"";if(i.label)return[i.label(),l];if(e.label)return o("label",{id:`${s}-label`,for:i.input?void 0:Q(),onClick:u=>{N(u),U()},style:a==="top"&&t?{width:Z(t)}:void 0},[e.label+l])},Ve=()=>[o("div",{class:b("body")},[Se(),O.value&&o(T,{ref:M,name:e.clearIcon,class:b("clear")},null),Ie(),i.button&&o("div",{class:b("button")},[i.button()])]),ke(),xe()];return je({blur:q,focus:U,validate:E,formValue:P,resetValidation:C,getValidationStatus:ye}),De($e,{customValue:w,resetValidation:C,validateWithTrigger:F}),Fe(()=>e.modelValue,()=>{B(h()),C(),F("onChange"),_(A)}),qe(()=>{B(h(),e.formatTrigger),_(A)}),Re("touchstart",he,{target:I(()=>{var t;return(t=M.value)==null?void 0:t.$el})}),()=>{const t=f("disabled"),a=f("labelAlign"),l=Ce(),u=()=>{const g=we();return a==="top"?[l,g].filter(Boolean):g||[]};return o(tt,{size:e.size,class:b({error:J.value,disabled:t,[`label-${a}`]:a}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:be.value,valueClass:b("value"),titleClass:[b("label",[a,{required:z.value}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:l&&a!=="top"?()=>l:null,title:u,value:Ve,extra:i.extra})}}});const yt=H(ut),[dt,ne]=G("cell-group"),ft={title:String,inset:Boolean,border:ae};var gt=K({name:dt,inheritAttrs:!1,props:ft,setup(e,{slots:n,attrs:i}){const s=()=>{var d;return o("div",ie({class:[ne({inset:e.inset}),{[Ke]:e.border&&!e.inset}]},i,He()),[(d=n.default)==null?void 0:d.call(n)])},r=()=>o("div",{class:ne("title",{inset:e.inset})},[n.title?n.title():e.title]);return()=>e.title||n.title?o(We,null,[r(),s()]):s()}});const St=H(gt);export{St as C,yt as F,Ue as r,Je as u};
